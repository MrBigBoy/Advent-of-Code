// Input map
string[] testData =
[
    "....#.....",
    ".........#",
    "..........",
    "..#.......",
    ".......#..",
    "..........",
    ".#..^.....",
    "........#.",
    "#.........",
    "......#..."
];

// input map
string[] data =
[
    "......#.............#.....................#..#.........................................................#.................#.#......",
    ".................................#.....#............#........................................#.................................#..",
    "..................#.#.....#........#.#...#.....#..............#................#..#....................................#..#.......",
    ".#....#......................#..........................................................................#......#..................",
    "..............#..................#..#............................................#.....#....#.........#...........................",
    "..............#.......#...#.....#....................................................................#...................#........",
    "....................................................#............#....................................#.............#........#....",
    "..........................#....#...................##.............#.#............................................#................",
    "...............#.......#..................................................#....#..............#..##.....##.................#......",
    "....#............#.......##................#......#.........#.#.......#...#......................#...##...........................",
    "#.........................................#.......#.....#......................#.........#......#.................................",
    ".......#.......#........#......#.......................#..........#....#.##.........#......#.....................#.#..............",
    "..........#.....................#.................#................................................................#..............",
    "...........................................#.................................#............#....................................#..",
    ".....................#.....#..........#...................................................###........#............................",
    ".....#.............#....#.................................#.#............##..#......................................#.............",
    "........#....#.................#..................#............................#...#.#.............#..............................",
    ".............................................#.....#.................................#............................................",
    "......................#.#...................#...#...........................#....#..#............#................................",
    ".......#...#.............#................#................#...............................................#...........#..........",
    "............#............................#..............................................#......................#................#.",
    "......#..............................................#......#.................................#..................................#",
    "................#...............................#.....................................................................#......#....",
    "#....#.............##..................................#.......#..............................#....#..............................",
    "...........#..................#.....#...................................#.........#.........................................#.....",
    ".....#........................#.#.............#.#.......................#........#.....................................#........#.",
    "...................................................................................................#..............................",
    "......#...........................#...................................................#....................................##...#.",
    "#..#...............#.....#............................#....................#...................#...............#..................",
    ".......#.........#......##...........................................#.......................#....................................",
    ".................................................................................#....................#.........#.................",
    "................................#............................................#..............#................................#....",
    ".............................#.............#.............#....#............#.#......#............#...........................#....",
    "....................................#....#...........##..........................................................#................",
    ".......#.....................................................................................#...............................#....",
    ".#....#...............#....................#............................#...............#....................#.................#..",
    "......................................#.#....#....#.......................................................#...................#...",
    "....................#.....#..............................#....................#...........................................#.......",
    "...............................................................................................#.........#........................",
    ".........#............#...........................................................................................................",
    "....#..#.....#..................#..........#.........#............##..#...........................................................",
    "....#.................................#.........................................................#...#..........#..................",
    "...................##.....#.....#.#...#..............................#.........#......#......#............#.......................",
    ".................#.....#....#..................................................................................#..............#...",
    ".....#............#........................................................#.........#..............#.......#.....................",
    "...........#...........................................................#...#..............................#.............#........#",
    "............#....#...............#.....#...................................................................#......................",
    "....#........................#..........#.............................#.....#................................#....................",
    "#............#................#....#..............................................................................................",
    ".......##..........#................................................................#.........#..............................##...",
    "..........#.....................................#.................#.........#................................................#.#..",
    "........#....................#...............#.#.................#..#.................#...............#..#.......................#",
    "................................#.............................##.........#.......#...........#....................................",
    ".....#........#....#...............#............##.......................................................#........................",
    "...#..............................#........................................................................................#......",
    ".....#............................................#............#.....#.........#.........................................#........",
    "........................................#......................................#.#.......#.................................#.#....",
    "..#......#..........................#........................................................................#........#.......#...",
    ".#.....#.#..#........#.......#....................................................................................................",
    "...............................................................#........#...#.....................................................",
    "..................#..........#..............................................#..........................#..........................",
    "..............................................................#................#......#....................#......................",
    "..........##.............#...............................................#...#......#......#.............#........................",
    ".#......#........#.......................#...................................................................................#....",
    ".........................#...........................................................................................#.......#....",
    ".......................................#.................................#......................#........................#..#.#..#",
    ".............#................................................#................#.....................#...................#......#.",
    "...#.....................#.................#.........................................#...#..............................#.........",
    "..#....................................#..............#...........#..........................................#....................",
    "......#...........................................................................................................................",
    "........##............................................#.......................................#.#...#..............##.............",
    ".........#...#.........#.........#...........#....................................................................................",
    ".#..#..........................................#.........^..................................#......................#.........#....",
    "..........................#..................................................#..............#..#......#....#.....#..........#....#",
    ".....................................#.......................................................................................#....",
    ".....#.......#...................#.......#...............................#..#...#...........................................#.....",
    ".........#.#........................................................#......#.....#................................................",
    "..#............#.....#.......#..........................#................................#..........#.............#...............",
    "...............................#....#..#...#..#...............#.......................#..........................................#",
    ".........................................#..............#.............#..........................................#................",
    "..........................#..#.........#........................................................................#.................",
    ".......#.....................................#........................#..#.....#..........#...#.........#.........................",
    "............................................................................................#...............................#.....",
    "....................................................................................#.............................................",
    "........#.................#...................................................................#.......#...........................",
    "..#....#......#............#................#.......#...........#......................#..................................##......",
    "...............#................................#.........#.............................#.........................#...............",
    "...................#...#.......................................................#..#....#......................................#...",
    "..........................##.........#..............................#.....##............#.........................................",
    "..............................................................................#...#.............................##.#..............",
    "#..................#..............................#...............................................................................",
    ".....#..........#.........................................................#.......#...........................##.........#........",
    "..##..#..#..........................#...#...#..............................................................#.#....................",
    "..#.#.........................#...........#...............................................#...#...........#.......................",
    "...............................#......................#......................#.#...............................#..................",
    ".......#.........................#....#..................................................#............#.#.........................",
    ".................#.........#.....#.............................................................................#..................",
    "............#.....................................................#.#................#......#.....#..................#............",
    ".#...............#..............................................................................................#................#",
    ".#....#.................................#..#....#......#...........#..........................................#...................",
    "#.#.................................................................................................................#.............",
    "........#..................#..................................................#................#.#...............#......#.........",
    "........#...................#......................#.......#.#...............#....................................................",
    ".................#.#.........#....#....................#...#........#...#...#.....................................................",
    ".........................#...............................#............................#.............#.................#...........",
    "....#...................................#.#.....................#.............#.........##......#........................#........",
    "..................#..#...#........#...#....#........#.............#............#.....#..............#.......................#.....",
    "....#....#......#..#.....................................#...#......#.........................................................#..#",
    ".....................#................#.#..##..............#...................................#...................#.#............",
    "...........................##.#...............##...........#.......................................................#............#.",
    "................#...................................................................#....#.........#........#..........#..........",
    "...#........#...........................#.............#.................##......#.................................................",
    "............#............................................#..............#...#...........................#.........................",
    ".....#...........................#...............#............#...........#.....................................#....#............",
    "...#................#.......#.......................#.......................................................#...............#.....",
    "..........................................#.....#..#........#..........................................#........................#.",
    "........#..................#.........#.....................#....#.......#..................#.............................#......#.",
    ".........#.#........................................................................#................................#.......#....",
    "..........................#.#..........#.........#.........#.......................#.......................................#......",
    ".........#............................#.............#...#.....#......................#......................................#...#.",
    "...#............................#...................#......................................................................#......",
    "............................#..........#..#..#....#................#..........#...............#.........#.....#...................",
    "##...#.........................#...........#.................#..............................#.....................................",
    "....#.................#.......#............#........#.............................................................#.......#......#",
    "............................##.#................#................#.#.............................................................#",
    ".....#.#........................#.............#.................#......#..........#.........................#....................#",
    "..........................................#.........................#.........................#.......#..#..........#.............",
    "....#.#......#...........................#................#...#.........##...............#..................#.....................",
    "...............................................#...#.#...#...#..........#...#........................#......#.....................",
    "....#.......#....................#........#........#......#.................##...................#.....#...#.............#........"
];

HashSet<(int, int)> visitedTest = RunSimulation(testData);
if (visitedTest.Count != 41)
{
    Console.WriteLine($"Test simulation did not get the correct count visited. Expected 41. Got {visitedTest.Count}");
    _ = Console.ReadLine();
    return;
}

HashSet<(int, int)> visited = RunSimulation(data);

// Output the number of unique positions visited
Console.WriteLine($"Distinct positions visited: {visited.Count}");
_ = Console.ReadLine();

static HashSet<(int, int)> RunSimulation(string[] input)
{
    // Movement directions: Up, Right, Down, Left
    // Corresponding dx and dy
    (int dx, int dy)[] directions = [(-1, 0), (0, 1), (1, 0), (0, -1)];

    // Parse input to find initial position and facing direction
    int guardX = 0, guardY = 0, facing = 0;
    int rows = input.Length;
    int cols = input[0].Length;

    for (int i = 0; i < rows; i++)
    {
        int col = input[i].IndexOf('^');
        if (col != -1)
        {
            guardX = i;
            guardY = col;
            facing = 0; // Guard starts facing up
            break;
        }
    }

    // Set of visited positions
    HashSet<(int, int)> visited =
    [
        (guardX, guardY), // Mark starting position as visited
        ];

    while (true)
    {
        // Calculate the position directly in front of the guard
        int nextX = guardX + directions[facing].dx;
        int nextY = guardY + directions[facing].dy;

        // Check if the guard moves out of bounds
        if (nextX < 0 || nextX >= rows || nextY < 0 || nextY >= cols)
            break;

        // Check if the cell in front is blocked
        if (input[nextX][nextY] == '#')
        {
            // Turn right 90 degrees
            facing = (facing + 1) % 4;
        }
        else
        {
            // Move forward
            guardX = nextX;
            guardY = nextY;

            // Mark the new position as visited
            _ = visited.Add((guardX, guardY));
        }
    }

    return visited;
}